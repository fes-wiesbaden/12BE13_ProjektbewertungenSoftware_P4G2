<div class="p-4">
  <!-- Header Section -->
  <div
    class="bg-white shadow rounded-lg p-4 my-4 sm:p-6 xl:p-8 dark:bg-gray-800 flex justify-between items-center"
  >
    <span class="font-bold text-3xl dark:text-white">Projects</span>
    <button
      type="button"
      (click)="openNewModel()"
      class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-center text-white rounded-lg bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 sm:w-auto dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition-colors"
    >
      <mat-icon class="w-5 h-5 mr-2">add</mat-icon>
      Add new Project
    </button>
  </div>

  <!-- Error Message -->
  <div
    *ngIf="errorMessage && !isLoading"
    class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 dark:bg-red-900 dark:border-red-700 dark:text-red-200"
    role="alert"
  >
    <span class="block sm:inline">{{ errorMessage }}</span>
    <button
      (click)="errorMessage = ''"
      class="absolute top-0 bottom-0 right-0 px-4 py-3"
    >
      <mat-icon class="w-5 h-5">close</mat-icon>
    </button>
  </div>

  <!-- All Projects Overview -->
  <div
    class="bg-white shadow rounded-lg p-4 my-4 sm:p-6 xl:p-8 dark:bg-gray-800"
  >
    <h2 class="text-2xl font-bold dark:text-white mb-4 flex items-center">
      <mat-icon class="mr-2">folder</mat-icon>
      All Projects
    </h2>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-12">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700"
      ></div>
      <span class="ml-3 text-gray-600 dark:text-gray-300"
      >Loading projects...</span
      >
    </div>

    <!-- Projects Grid -->
    <div
      *ngIf="!isLoading"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
    >
      <div
        *ngFor="let proj of projects"
        (click)="viewProjectDetails(proj.id)"
        class="bg-white shadow rounded-lg p-4 dark:bg-gray-700 hover:shadow-lg transition-all cursor-pointer hover:ring-2 hover:ring-blue-500 hover:scale-[1.02] duration-200"
      >
        <div class="flex justify-between items-start mb-3">
          <div class="flex-1">
            <h3 class="text-xl font-semibold dark:text-white mb-2">
              {{ proj.title }}
            </h3>
            <p
              *ngIf="proj.description"
              class="text-sm text-gray-600 dark:text-gray-300 mb-3 line-clamp-2"
            >
              {{ proj.description }}
            </p>
          </div>
        </div>

        <!-- Status Badge -->
        <div class="mb-3">
          <span
            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
            [ngClass]="{
              'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200':
                proj.status === 'completed',
              'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200':
                proj.status === 'active',
              'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200':
                proj.status === 'pending',
              'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200':
                proj.status === 'overdue',
              'bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200':
                proj.status === 'on-hold' || proj.status === 'cancelled'
            }"
          >
            {{ getStatusLabel(proj.status) }}
          </span>
        </div>

        <!-- Project Info -->
        <div
          class="flex flex-wrap gap-3 items-center text-xs text-gray-600 dark:text-gray-400"
        >
          <span class="flex items-center">
            <mat-icon
              class="mr-1"
              style="font-size: 16px; width: 16px; height: 16px"
            >groups</mat-icon
            >
            {{ proj.groups?.length || 0 }} team{{
              (proj.groups?.length || 0) !== 1 ? "s" : ""
            }}
          </span>
          <span class="flex items-center">
            <mat-icon
              class="mr-1"
              style="font-size: 16px; width: 16px; height: 16px"
            >event</mat-icon
            >
            {{ proj.dueDate | date : "MMM d, yyyy" }}
          </span>
        </div>
      </div>

      <!-- Empty State -->
      <div
        *ngIf="projects.length === 0 && !isLoading"
        class="col-span-full text-center py-12"
      >
        <mat-icon
          class="text-gray-400 dark:text-gray-600 mb-4"
          style="font-size: 64px; width: 64px; height: 64px"
        >folder_open</mat-icon
        >
        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">
          No projects yet
        </h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">
          Get started by creating your first project!
        </p>
        <button
          (click)="openNewModel()"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:ring-blue-300"
        >
          <mat-icon class="mr-2">add</mat-icon>
          Create Project
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add New Project Modal -->
<div
  *ngIf="showNewModel"
  class="fixed inset-0 z-50 flex items-center justify-center overflow-x-hidden overflow-y-auto bg-gray-900/50 dark:bg-gray-900/60 backdrop-blur-sm"
  (click)="closeNewModel()"
>
  <div
    class="relative w-full h-full max-w-2xl px-4 md:h-auto"
    (click)="$event.stopPropagation()"
  >
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-800">
      <!-- Modal Header -->
      <div
        class="flex items-start justify-between p-5 border-b rounded-t dark:border-gray-700 border-gray-200"
      >
        <h3 class="text-xl font-semibold dark:text-white">Add New Project</h3>
        <button
          type="button"
          (click)="closeNewModel()"
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-700 dark:hover:text-white"
        >
          <mat-icon class="w-5 h-5">close</mat-icon>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-6">
        <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
          <div class="grid grid-cols-1 gap-6">
            <!-- Project Name -->
            <div>
              <label
                for="project-name"
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >
                Project Name <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                formControlName="projectName"
                id="project-name"
                class="shadow-sm bg-gray-50 border text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                [ngClass]="{
                  'border-gray-300':
                    !projectForm.get('projectName')?.invalid ||
                    !projectForm.get('projectName')?.touched,
                  'border-red-500':
                    projectForm.get('projectName')?.invalid &&
                    projectForm.get('projectName')?.touched
                }"
                placeholder="Einrichtung eines IT-gestÃ¼tzten Arbeitsplatzes"
              />
              <p
                *ngIf="
                  projectForm.get('projectName')?.invalid &&
                  projectForm.get('projectName')?.touched
                "
                class="mt-1 text-sm text-red-600 dark:text-red-400"
              >
                Project name is required (min 3 characters)
              </p>
            </div>

            <!-- Deadline -->
            <div>
              <label
                for="deadline"
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >
                Deadline <span class="text-red-500">*</span>
              </label>
              <input
                type="date"
                formControlName="deadline"
                id="deadline"
                class="shadow-sm bg-gray-50 border text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                [ngClass]="{
                  'border-gray-300':
                    !projectForm.get('deadline')?.invalid ||
                    !projectForm.get('deadline')?.touched,
                  'border-red-500':
                    projectForm.get('deadline')?.invalid &&
                    projectForm.get('deadline')?.touched
                }"
              />
              <p
                *ngIf="
                  projectForm.get('deadline')?.invalid &&
                  projectForm.get('deadline')?.touched
                "
                class="mt-1 text-sm text-red-600 dark:text-red-400"
              >
                Deadline is required
              </p>
            </div>

            <!-- Description -->
            <div>
              <label
                for="description"
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >
                Description
              </label>
              <textarea
                formControlName="description"
                id="description"
                rows="4"
                class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                placeholder="Project Description here..."
              ></textarea>
            </div>
          </div>

          <!-- Modal Footer -->
          <div
            class="flex items-center justify-between pt-6 mt-6 border-t border-gray-200 dark:border-gray-700"
          >
            <button
              type="button"
              (click)="closeNewModel()"
              class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600"
            >
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="projectForm.invalid || isSubmitting"
              class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center"
            >
              <span *ngIf="isSubmitting" class="mr-2">
                <svg
                  class="animate-spin h-4 w-4 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  ></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
              </span>
              {{ isSubmitting ? "Saving..." : "Save Project" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
